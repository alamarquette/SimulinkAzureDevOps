# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

variables:
  MATHWORKS_SKIP_ACTIVATION: true

pool:
  vmImage: ubuntu-latest

steps:
- task: InstallMATLAB@0
  inputs:
    release: R2022b
- task: RunMATLABTests@0
  inputs:
    testResultsPDF: test-results/results.pdf
    testResultsJUnit: test-results/results.xml
    codeCoverageCobertura: code-coverage/coverage.xml
  env:
    MATHWORKS_TOKEN: $(MATHWORKS_TOKEN)
    MATHWORKS_ACCOUNT: $(MATHWORKS_ACCOUNT)
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: test-results/results.pdf
- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testResultsFiles: test-results/results.xml

- task: PublishCodeCoverageResults@1
  inputs:
    codeCoverageTool: Cobertura
    summaryFileLocation: code-coverage/coverage.xml